!function(t,e){var n=/^\s*(.*?)\s*$/,s={fi:{trash_label:"Raahaa rivit ohjelmaasi tästä",solution_label:"Muodosta ratkaisusi tähän",order:function(){return"Ohjelma sisältää vääriä palasia tai palasten järjestys on väärä. Tämä on mahdollista korjata siirtämällä, poistamalla tai vaihtamalla korostettuja palasia."},lines_missing:function(){return"Ohjelmassasi on liian vähän palasia, jotta se toimisi oikein."},lines_too_many:function(){return"Ohjelmassasi on liian monta palasta, jotta se toimisi oikein."},no_matching:function(t){return"Korostettu palanen ("+t+") on sisennetty kieliopin vastaisesti."},no_matching_open:function(t,e){return"Rivillä "+t+" päätettävää "+e+" lohkoa ei ole aloitettu."},no_matching_close:function(t,e){return e+" lohkoa riviltä "+t+" ei ole päätetty."},block_close_mismatch:function(t,e,n,s){return"Ei voi päättää lohkoa "+e+" rivillä "+t+" oltaessa vielä lohkossa "+s+" riviltä "+n},block_structure:function(t){return"Korostettu palanen ("+t+") on sisennetty väärään koodilohkoon."},unittest_error:function(t){return"<span class='msg'>Virhe ohjelman jäsentämisessä/suorituksessa</span><br/> <span class='errormsg'>"+t+"</span>"},unittest_output_assertion:function(t,e){return"Odotettu tulostus: <span class='expected output'>"+t+"</span>Ohjelmasi tulostus: <span class='actual output'>"+e+"</span>"},unittest_assertion:function(t,e){return"Odotettu arvo: <span class='expected'>"+t+"</span><br>Ohjelmasi antama arvo: <span class='actual'>"+e+"</span>"},variabletest_assertion:function(t,e,n){return"Muuttujan "+t+" odotettu arvo: <span class='expected'>"+e+"</span> Ohjelmasi antama arvo: <span class='actual'>"+n+"</span>"}},en:{trash_label:"Drag from here",solution_label:"Construct your solution here",order:function(){return"Code fragments in your program are wrong, or in wrong order. This can be fixed by moving, removing, or replacing highlighted fragments."},lines_missing:function(){return"Your program has too few code fragments."},lines_too_many:function(){return"Your program has too many code fragments."},no_matching:function(t){return"Based on language syntax, the highlighted fragment ("+t+") is not correctly indented."},no_matching_open:function(t,e){return"The "+e+" ended on line "+t+" never started."},no_matching_close:function(t,e){return"Block "+e+" defined on line "+t+" not ended properly"},block_close_mismatch:function(t,e,n,s){return"Cannot end block "+e+" on line "+t+" when still inside block "+s+" started on line "+n},block_structure:function(t){return"The highlighted fragment "+t+" belongs to a wrong block (i.e. indentation)."},unittest_error:function(t){return"<span class='msg'>Error in parsing/executing your program</span><br/> <span class='errormsg'>"+t+"</span>"},unittest_output_assertion:function(t,e){return"Expected output: <span class='expected output'>"+t+"</span>Output of your program: <span class='actual output'>"+e+"</span>"},unittest_assertion:function(t,e){return"Expected value: <span class='expected'>"+t+"</span><br>Actual value: <span class='actual'>"+e+"</span>"},variabletest_assertion:function(t,e,n){return"Expected value of variable "+t+": <span class='expected'>"+e+"</span><br>Actual value: <span class='actual'>"+n+"</span>"}}},o={},i=function(t){this.parson=t};o.VariableCheckGrader=i,i.prototype._python_exec=function(t){var e="";return Sk.execLimit=this.parson.options.exec_limit||2500,Sk.configure({output:function(t){e+=t},python3:this.parson.options.python3||!1,read:function(t){if(void 0===Sk.builtinFiles||void 0===Sk.builtinFiles.files[t])throw"File not found: '"+t+"'";return Sk.builtinFiles.files[t]}}),{mainmod:Sk.importMainWithBody("<stdin>",!1,t),output:e}},i.prototype._variablesAfterExecution=function(t,e){var n,s,o,i={variables:{}};try{n=this._python_exec(t)}catch(t){return{_output:"",_error:""+t}}s=n.mainmod;for(var r=0;r<e.length;r++)o=e[r],i.variables[o]=s.tp$getattr(o);return i._output=n.output,i},i.prototype.formatVariableValue=function(e){var n=typeof e;return"undefined"===n||null===e?"None":"string"===n?'"'+e+'"':"boolean"===n?e?"True":"False":t.isArray(e)?"["+e.join(", ")+"]":"object"===n&&"number"===e.tp$name?e.v:"object"===n&&"NoneType"===e.tp$name?"None":"object"===n&&"bool"===e.tp$name?e.v?"True":"False":"object"===n&&"str"===e.tp$name?'"'+e.v+'"':"object"===n&&"list"===e.tp$name?"["+e.v.join(", ")+"]":e},i.prototype.stripLinenumberIfNeeded=function(t,e,n){var s=t.match(/.*on line ([0-9]+).*/);if(s){var o=parseInt(s[1],10),i=e?e.split("\n").length:0,r=i+n.split("\n").length-1;if(o<=i||o>r)return t.replace(" on line "+o,"");if(i>0)return t.replace(" on line "+o," on line "+(o-i))}return t},i.prototype._codelinesAsString=function(){var e=this.parson.getModifiedCode("#ul-"+this.parson.options.sortableId),n="";return t.each(e,(function(e,s){for(var o=t("#"+s.id).html().split(/<br\s*\/?>/),i=0;i<o.length;i++)n+=u[s.indent]+t("<span>"+o[i]+"</span>").text()+"\n"})),n},i.prototype.grade=function(n){var s=this.parson,o=this,i="",r=[],a=!0;return t.each(s.options.vartests,(function(t,l){var p,d,u=n||o._codelinesAsString(),c=(l.initcode||"")+"\n"+u+"\n"+(l.code||"");"variables"in l?(p=e.keys(l.variables),d=l.variables):(p=[l.variable],(d={})[l.variable]=l.expected);var h,g,f=o._variablesAfterExecution(c,p),m="",_=!0,v={code:l.code,msg:l.message};if("_error"in f)m+=s.translations.unittest_error(o.stripLinenumberIfNeeded(f._error,l.initcode,u)),_=!1,v.type="error",v.errormsg=f._error;else{v.type="assertion",v.variables={};for(var y=0;y<p.length;y++){var b,I=p[y];"__output"===I?(h=d[I],m+="<div class='"+((b=(g=f._output)==h)?"pass":"fail")+"'>",m+=s.translations.unittest_output_assertion(h,g)+"</div>"):(h=o.formatVariableValue(d[I]),m+="<div class='"+((b=(g=o.formatVariableValue(f.variables[I]))==h)?"pass":"fail")+"'>",m+=s.translations.variabletest_assertion(I,h,g)+"</div>"),v.variables[I]={expected:h,actual:g},b||(_=!1)}}a=a&&_,v.success=_,r.push(v),i+="<div class='testcase "+(_?"pass":"fail")+"'><span class='msg'>"+l.message+"</span><br>"+m+"</div>"})),{html:i,tests:r,success:a}};var r=function(t){this.parson=t;var e=this._executeTurtleModel(),n=[{initcode:"import parsonturtle\nmyTurtle = parsonturtle.ParsonTurtle()\nmyTurtle.speed(0.3)\nmyTurtle.pensize(3, False)\n"+("boolean"!=typeof t.options.turtlePenDown||t.options.turtlePenDown?"":"myTurtle.up()\n"),code:(t.options.turtleTestCode?t.options.turtleTestCode:"")+"\ncommands = myTurtle.commands()",message:"",variables:{commands:e}}];t.options.vartests=n};o.TurtleGrader=r,r.prototype._python_exec=i.prototype._python_exec,r.prototype._variablesAfterExecution=i.prototype._variablesAfterExecution,r.prototype._executeTurtleModel=function(){var t="import parsonturtle\nmodelTurtle = parsonturtle.ParsonTurtle()\nmodelTurtle.color(160, 160, 160, False)\n"+this.parson.options.turtleModelCode+"\ncommands = modelTurtle.commands()\n";Sk.canvas=this.parson.options.turtleModelCanvas||"modelCanvas";var e=this._variablesAfterExecution(t,["commands"]);return e.variables&&e.variables.commands&&e.variables.commands.v?e.variables.commands.v:"None"},r.prototype.grade=function(){return Sk.canvas=this.parson.options.turtleStudentCanvas||"studentCanvas",this.parson.options.executable_code?new l(this.parson).grade():new i(this.parson).grade()};var a=function(t){this.parson=t};o.UnitTestGrader=a,a.prototype.stripLinenumberIfNeeded=i.prototype.stripLinenumberIfNeeded,a.prototype._codelinesAsString=i.prototype._codelinesAsString,a.prototype._python_exec=i.prototype._python_exec,a.prototype.grade=function(t){var e,n,s=!0,o=this.parson,i=o.options.unittests,r=t||this._codelinesAsString(),a="",l=r+"\n"+i;o.options.unittest_code_prepend&&(l=o.options.unittest_code_prepend+"\n"+l);try{n=this._python_exec(l).mainmod,e=JSON.parse(n.tp$getattr("_test_result").v)}catch(t){e=[{status:"error",_error:t.toString()}]}for(var p=0,d=e.length;p<d;p++){var u=e[p];a+='<div class="testcase '+u.status+'">',"error"===u.status?(a+=o.translations.unittest_error(this.stripLinenumberIfNeeded(u._error,o.options.unittest_code_prepend,r)),s=!1):(a+='<span class="msg">'+this.stripLinenumberIfNeeded(u.feedback)+"</span><br />",a+='Expected <span class="expected">'+u.expected+"</span>"+u.test+'<span class="actual">'+u.actual+"</span>","fail"===u.status&&(s=!1)),a+="</div>"}return{html:a,tests:e,success:s}};var l=function(t){this.parson=t};o.LanguageTranslationGrader=l;var p={};l._languageBlocks=p,p.pseudo={open:{"^s*IF.*THENs*$":"IF","^s*ELSEs*$":"IF","^s*WHILE.*DOs*$":"WHILE","^s*REPEAT.*TIMESs*$":"REPEAT..TIMES","^s*REPEATs*$":"REPEAT","^s*FOR.*DOs*$":"FOR","^s*FOR.*TO.*s*$":"FOR","^s*MODULE.*\\)s*$":"MODULE","^s*MODULE.*RETURNS.*$":"MODULE","^s*DOs*$":"DO..WHILE"},close:{"^s*ELSEs*$":"IF","^s*ENDIFs*$":"IF","^s*ENDWHILEs*$":"WHILE","^s*ENDREPEATs*$":"REPEAT..TIMES","^s*UNTIL.*s*$":"REPEAT","^s*ENDFORs*$":"FOR","^s*ENDMODULEs*$":"MODULE","^s*WHILE(?!.*DO)":"DO..WHILE"}},p.java={open:{"^.*{s*$":"block"},close:{"^.*}s*$":"block"}},l.prototype.grade=function(){var e,n=this.parson.normalizeIndents(this.parson.getModifiedCode("#ul-"+this.parson.options.sortableId)),s=this.parson.options.block_open,o=this.parson.options.block_close,r=[],p=this.parson.options.programmingLang;if(p&&l._languageBlocks[p]&&(s=t.extend({},s,l._languageBlocks[p].open),o=t.extend({},o,l._languageBlocks[p].close)),s&&o){var d=[],u=0,c=0;for(e=0;e<n.length;e++){var h,g,f=!1,m=!1,_=n[e],v=t("#"+_.id).text();if(_.indent<0){r.push(this.parson.translations.no_matching(e+1)),t("#"+_.id).addClass("incorrectIndent");break}for(var y in o)if(new RegExp(y).test(v)){f=!0,(h=d.pop())?o[y]!==h.name?(r.push(this.parson.translations.block_close_mismatch(e+1,o[y],h.line,h.name)),t("#"+_.id).addClass("incorrectPosition")):n[e].indent!==h.indent&&(r.push(this.parson.translations.no_matching(e+1)),t("#"+_.id).addClass("incorrectIndent")):(r.push(this.parson.translations.no_matching_open(e+1,o[y])),t("#"+_.id).addClass("incorrectPosition")),u=h?h.indent:0,c=0;break}for(var b in s)if(new RegExp(b).test(v)){m=!0,g={name:s[b],indent:n[e].indent,line:e+1,item:_},d.push(g),u=0,c=g.indent;break}if(!f&&!m&&d.length>0&&((u&&n[e].indent!==u||n[e].indent<=c)&&(r.push(this.parson.translations.no_matching(e+1)),t("#"+_.id).addClass("incorrectIndent")),u=n[e].indent),r.length>0){d=[];break}}for(e=0;e<d.length;e++)r.push(this.parson.translations.no_matching_close(d[e].line,d[e].name)),t("#"+d[e].item.id).addClass("incorrectPosition")}if(r.length>0){var I="<div class='testcase fail'>",x="";for(e=0;e<r.length;e++)x+=r[e]+"</br>";return I+=this.parson.translations.unittest_error(x),{html:I+="</div>",success:!1}}var L=this._replaceCodelines();return this.parson.options.unittests?new a(this.parson).grade(L):new i(this.parson).grade(L)},l.prototype._replaceCodelines=function(){var e=this.parson.normalizeIndents(this.parson.getModifiedCode("#ul-"+this.parson.options.sortableId)),n="",s=this.parson,o=s.options.executable_code;"string"==typeof o&&(o=o.split("\n"));var i=new RegExp("\\$\\$toggle("+s.options.toggleSeparator+".*?)?\\$\\$","g");return t.each(e,(function(t,e){var r=parseInt(e.id.replace(s.id_prefix,""),10),a=o[r],l=a.match(i);if(l)for(var p=0;p<l.length;p++){var d=l[p].substring(10,l[p].length-2).split(s.options.toggleSeparator);a=d.length>=1&&"$$"!==d[0]?a.replace(l[p],d[e.selectedToggleIndex(p)]):a.replace(l[p],e.toggleValue(p))}var c=a.split(/<br\s*\/?>/);for(p=0;p<c.length;p++)n+=u[e.indent]+c[p]+"\n"})),n};var d=function(t){this.parson=t};o.LineBasedGrader=d,d.prototype.grade=function(e){var n,s=this.parson,o=e||s.options.sortableId,i=s.normalizeIndents(s.getModifiedCode("#ul-"+o)),r=Math.min(i.length,s.model_solution.length),a=[],l=[],p=[],d=[],u=!1;for(n=0;n<i.length;n++)d.push(t.extend(!0,{},s.getLineById(i[n].id)));var c={};t.each(d,(function(t,e){for(var n=void 0!==c[e.code]?c[e.code]+1:0;n<s.model_solution.length;n++)if(s.model_solution[n].code===e.code){c[e.code]=n,e.lisIgnore=!1,e.position=n;break}n===s.model_solution.length&&(void 0===c[e.code]?(u=!0,e.markIncorrectPosition(),p.push(e.orig),e.lisIgnore=!0):(e.lisIgnore=!1,e.position=c[e.code]))}));var h=d.filter((function(t){return!t.lisIgnore})),g=LIS.best_lise_inverse_indices(h.map((function(t){return t.position})));if(t.each(g,(function(t,e){h[e].markIncorrectPosition(),p.push(h[e].orig)})),(g.length>0||p.length>0)&&(u=!0,l.push({type:"incorrectPosition",lines:p})),u&&a.push(s.translations.order()),s.model_solution.length<i.length?(t("#ul-"+o).addClass("incorrect"),a.push(s.translations.lines_too_many()),l.push({type:"tooManyLines",lines:i.length})):s.model_solution.length>i.length&&(t("#ul-"+o).addClass("incorrect"),a.push(s.translations.lines_missing()),l.push({type:"tooFewLines",lines:i.length})),0===a.length)for(n=0;n<r;n++){var f=i[n],m=s.model_solution[n];f.indent===m.indent||s.options.first_error_only&&0!==a.length||(f.markIncorrectIndent(),a.push(s.translations.block_structure(n+1)),l.push({type:"incorrectIndent",line:n+1})),f.code==m.code&&f.indent==m.indent&&0===a.length&&f.markCorrect()}return{errors:a,log_errors:l,success:0===a.length}};for(var u=[],c="",h=0;h<20;h++)u[h]=c,c+="  ";var g={boolean:["True","False"],compop:["<",">","<=",">=","==","!="],mathop:["+","-","*","/"],boolop:["and","or"],range:function(t){for(var e=parseFloat(t.data("min")||"0"),n=parseFloat(t.data("max")||"10"),s=parseFloat(t.data("step")||"1"),o=[],i=e;i<=n;)o.push(""+i),i+=s;return o}},f=function(t,e){this.widget=e,this.code="",this.indent=0,this._toggles=[],t&&(this.code=t.replace(/#distractor\s*$/,"").replace(n,"$1").replace(/\\n/g,"\n"),this.indent=t.length-t.replace(/^\s+/,"").length)};f.prototype.elem=function(){return t("#"+this.id)},f.prototype.markCorrect=function(){this.elem().addClass(this.widget.FEEDBACK_STYLES.correctPosition)},f.prototype.markIncorrectPosition=function(){this.elem().addClass(this.widget.FEEDBACK_STYLES.incorrectPosition)},f.prototype.markIncorrectIndent=function(){this.elem().addClass(this.widget.FEEDBACK_STYLES.incorrectIndent)},f.prototype._addToggles=function(){var t=new RegExp("\\$\\$toggle("+this.widget.options.toggleSeparator+".*?)?\\$\\$","g"),e=this.code.match(t),n=this;if(this._toggles=[],e){for(var s=this.code,o=0;o<e.length;o++){var i=e[o].substring(10,e[o].length-2).split(this.widget.options.toggleSeparator);s=s.replace(e[o],"<span class='jsparson-toggle' data-jsp-options='"+JSON.stringify(i).replace("<","&lt;")+"'></span>")}this.elem().html(s),this.elem().find(".jsparson-toggle").each((function(t,e){n._toggles.push(e)}))}},f.prototype.toggleCount=function(){return this._toggles.length},f.prototype.selectedToggleIndex=function(e){if(e<0||e>=this._toggles.length)return-1;var n=this._toggles[e];return t(n).data("jsp-options").indexOf(n.textContent)},f.prototype.toggleValue=function(t){if(!(t<0||t>=this._toggles.length))return this._toggles[t].textContent},window.ParsonsCodeline=f;var m=function(t){this.modified_lines=[],this.extra_lines=[],this.model_solution=[],this.user_actions=[],this.state_path=[],this.states={},this.options=jQuery.extend({},{incorrectSound:!1,x_indent:50,can_indent:!0,feedback_cb:!1,first_error_only:!0,max_wrong_lines:10,lang:"en",toggleSeparator:"::"},t),this.feedback_exists=!1,this.id_prefix=t.sortableId+"codeline",s.hasOwnProperty(this.options.lang)?this.translations=s[this.options.lang]:this.translations=s.en,this.options.hasOwnProperty("trash_label")||(this.options.trash_label=this.translations.trash_label),this.options.hasOwnProperty("solution_label")||(this.options.solution_label=this.translations.solution_label),this.FEEDBACK_STYLES={correctPosition:"correctPosition",incorrectPosition:"incorrectPosition",correctIndent:"correctIndent",incorrectIndent:"incorrectIndent"},this.options.grader&&e.isFunction(this.options.grader)?this.grader=new this.options.grader(this):void 0!==this.options.unittests?this.grader=new a(this):void 0!==this.options.vartests?this.grader=new i(this):this.grader=new d(this)};m._graders=o,m.prototype.parseCode=function(e,n){var s,o=[],i=[],r=[],a=[],l=this;t.each(e,(function(t,e){(s=new f(e,l)).orig=t,e.search(/#distractor\s*$/)>=0?(s.indent=-1,s.distractor=!0,s.code.length>0&&o.push(s)):s.code.length>0&&(s.distractor=!1,i.push(s))}));var p=this.normalizeIndents(i);t.each(p,(function(t,e){e.indent<0&&a.push(this.translations.no_matching(p.orig)),r.push(e)}));for(var d=this.getRandomPermutation(o.length),u=[],c=0;c<n;c++)u.push(o[d[c]]),r.push(o[d[c]]);return{solution:t.extend(!0,[],p),distractors:t.extend(!0,[],u),widgetInitial:t.extend(!0,[],r),errors:a}},m.prototype.init=function(e){var n=this.parseCode(e.split("\n"),this.options.max_wrong_lines);this.model_solution=n.solution,this.extra_lines=n.distractors,this.modified_lines=n.widgetInitial;var s=this.id_prefix;t.each(this.modified_lines,(function(t,e){e.id=s+t,e.indent=0}))},m.prototype.getHash=function(e){for(var n,s=[],o=t(e).sortable("toArray"),i=0;i<o.length;i++)n=this.getLineById(o[i]),s.push(n.orig+"_"+n.indent);return 0===s.length?"-":s.join("-")},m.prototype.solutionHash=function(){return this.getHash("#ul-"+this.options.sortableId)},m.prototype.trashHash=function(){return this.getHash("#ul-"+this.options.trashId)},m.prototype.whatWeDidPreviously=function(){var n=this.solutionHash(),s=this.states[n];if(s){var o,i,r=e.filter(this.state_path,(function(t){return t==n})).length-1,a=0,l=["removeOutput","addOutput","moveOutput"];for(o=this.state_path.length-2;o>0&&((i=this.states[this.state_path[o]])&&-1!=l.indexOf(i.type)&&a++,n!==this.state_path[o]);o--);return t.extend(!1,{visits:r,stepsToLast:a},s)}},m.prototype._getToggleStates=function(){var e=t("#"+this.options.sortableId+", #"+this.options.trashId),n=(t(".jsparson-toggle",e),{});return t("#"+this.options.sortableId+" .jsparson-toggle").each((function(){n.output||(n.output=[]),n.output.push(t(this).text())})),this.options.trashId&&(n.input=[],t("#"+this.options.trashId+" .jsparson-toggle").each((function(){n.input.push(t(this).text())}))),n.output&&n.output.length>0||n.input&&n.input.length>0?n:void 0},m.prototype.addLogEntry=function(e){var n,s,o={time:new Date,output:this.solutionHash(),type:"action"};this.options.trashId&&(o.input=this.trashHash()),e.target&&(e.target=e.target.replace(this.id_prefix,""));var i=this._getToggleStates();i&&(o.toggleStates=i),n=o.output,jQuery.extend(o,e),this.user_actions.push(o),this.state_path.length>0&&(s=this.state_path[this.state_path.length-1],this.states[s]=o),this.state_path[this.state_path.length-1]!==n&&this.state_path.push(n),t.isFunction(this.options.action_cb)&&this.options.action_cb.call(this,o)},m.prototype.updateIndent=function(t,e){var n=this.getLineById(e),s=this.options.can_indent?n.indent+Math.floor(t/this.options.x_indent):0;return s=Math.max(0,s),n.indent=s,s},m.prototype.getLineById=function(t){for(var e=-1,n=0;n<this.modified_lines.length;n++)if(this.modified_lines[n].id==t){e=n;break}return this.modified_lines[e]},m.prototype.normalizeIndents=function(t){for(var e,n=[],s=function(e){for(var s=e-1;s>=0;s--)if(t[s].indent==t[e].indent)return n[s].indent;return-1},o=0;o<t.length;o++)e=jQuery.extend({},t[o]),0===o?(e.indent=0,0!==t[o].indent&&(e.indent=-1)):t[o].indent==t[o-1].indent?e.indent=n[o-1].indent:t[o].indent>t[o-1].indent?e.indent=n[o-1].indent+1:e.indent=s(o),n[o]=e;return n},m.prototype.getModifiedCode=function(e){var n,s,o=[],i=t(e).sortable("toArray");for(n=0;n<i.length;n++)s=this.getLineById(i[n]),o.push(t.extend(new f,s));return o},m.prototype.hashToIDList=function(t){var e,n;n="-"===t||""===t||null===t?[]:t.split("-");for(var s=[],o=0;o<n.length;o++)e=n[o].split("_"),s.push(this.modified_lines[e[0]].id);return s},m.prototype.updateIndentsFromHash=function(t){var e,n;n="-"===t||""===t||null===t?[]:t.split("-");for(var s=0;s<n.length;s++)e=n[s].split("_"),this.modified_lines[e[0]].indent=Number(e[1]),this.updateHTMLIndent(this.modified_lines[e[0]].id);return[]},m.prototype.displayError=function(e){this.options.incorrectSound&&t.sound&&t.sound.play(this.options.incorrectSound),alert(e)},m.prototype.colorFeedback=function(t){return new d(this).grade(t)},m.prototype.getFeedback=function(){this.feedback_exists=!0;var e=this.grader.grade();return this.options.feedback_cb&&this.options.feedback_cb(e),e.success&&t("#ul-"+this.options.sortableId).addClass("correct"),"html"in e?(this.addLogEntry({type:"feedback",tests:e.tests,success:e.success}),{feedback:e.html,success:e.success}):(this.addLogEntry({type:"feedback",errors:e.log_errors,success:e.success}),e.errors)},m.prototype.clearFeedback=function(){if(this.feedback_exists){t("#ul-"+this.options.sortableId).removeClass("incorrect correct");var e=t("#ul-"+this.options.sortableId+" li");t.each(this.FEEDBACK_STYLES,(function(t,n){e.removeClass(n)}))}this.feedback_exists=!1},m.prototype.getRandomPermutation=function(t){var e,n,s,o,i=[];for(e=0;e<t;e++)i.push(e);for(e=0;e<t;e++)n=Math.floor(Math.random()*t),s=Math.floor(Math.random()*t),o=i[n],i[n]=i[s],i[s]=o;return i},m.prototype.shuffleLines=function(){var e=(this.options.permutation?this.options.permutation:this.getRandomPermutation)(this.modified_lines.length),n=[];for(var s in e)n.push(this.modified_lines[e[s]].id);this.options.trashId?this.createHTMLFromLists([],n):this.createHTMLFromLists(n,[]),function(e){for(var n=0;n<e.modified_lines.length;n++)e.modified_lines[n]._addToggles();if(e.options.unittests||e.options.vartests){var s=t.extend(g,e.options.toggleTypeHandlers),o=t("#"+e.options.sortableId+", #"+e.options.trashId);t(".jsparson-toggle",o).each((function(e,n){var o=t(n).data("type");if(o){var i,r=s[o];(i=t.isFunction(r)?r(t(n)):r)&&t.isArray(i)&&t(n).attr("data-jsp-options",JSON.stringify(i))}})),o.off("click",".jsparson-toggle").on("click",".jsparson-toggle",(function(){var n=t(this),s=n.text(),o=n.data("jsp-options"),i=o[(o.indexOf(s)+1)%o.length],r=n.parent("li");e.clearFeedback(),n.text(i),e.addLogEntry({type:"toggle",oldvalue:s,newvalue:i,target:r[0].id,toggleindex:r.find(".jsparson-toggle").index(n)})}))}}(this)},m.prototype.createHTMLFromHashes=function(t,e){var n=this.hashToIDList(t),s=this.hashToIDList(e);this.createHTMLFromLists(n,s),this.updateIndentsFromHash(t)},m.prototype.updateHTMLIndent=function(e){var n=this.getLineById(e);t("#"+e).css("margin-left",this.options.x_indent*n.indent+"px")},m.prototype.codeLineToHTML=function(t){return'<li id="'+t.id+'" class="prettyprint lang-py">'+t.code+"</li>"},m.prototype.codeLinesToHTML=function(t,e){var n=[];for(var s in t){var o=this.getLineById(t[s]);n.push(this.codeLineToHTML(o))}return'<ul id="ul-'+e+'">'+n.join("")+"</ul>"},m.prototype.createHTMLFromLists=function(e,n){var s;this.options.trashId?(s=(this.options.trash_label?"<p>"+this.options.trash_label+"</p>":"")+this.codeLinesToHTML(n,this.options.trashId),t("#"+this.options.trashId).html(s),s=(this.options.solution_label?"<p>"+this.options.solution_label+"</p>":"")+this.codeLinesToHTML(e,this.options.sortableId),t("#"+this.options.sortableId).html(s)):(s=this.codeLinesToHTML(e,this.options.sortableId),t("#"+this.options.sortableId).html(s)),window.prettyPrint&&(void 0===this.options.prettyPrint||this.options.prettyPrint)&&prettyPrint();var o=this,i=t("#ul-"+this.options.sortableId).sortable({start:function(){o.clearFeedback()},stop:function(e,n){t(e.target)[0]==n.item.parent()[0]&&(o.updateIndent(n.position.left-n.item.parent().position().left,n.item[0].id),o.updateHTMLIndent(n.item[0].id),o.addLogEntry({type:"moveOutput",target:n.item[0].id},!0))},receive:function(t,e){o.updateIndent(e.position.left-e.item.parent().position().left,e.item[0].id),o.updateHTMLIndent(e.item[0].id),o.addLogEntry({type:"addOutput",target:e.item[0].id},!0)},grid:!!o.options.can_indent&&[o.options.x_indent,1]});if(i.addClass("output"),this.options.trashId){var r=t("#ul-"+this.options.trashId).sortable({connectWith:i,start:function(){o.clearFeedback()},receive:function(t,e){o.getLineById(e.item[0].id).indent=0,o.updateHTMLIndent(e.item[0].id),o.addLogEntry({type:"removeOutput",target:e.item[0].id},!0)},stop:function(e,n){t(e.target)[0]==n.item.parent()[0]&&o.addLogEntry({type:"moveInput",target:n.item[0].id},!0)}});i.sortable("option","connectWith",r)}for(var a=[],l=0;l<this.modified_lines.length;l++){var p=this.modified_lines[l];a.push({code:p.code,distractor:p.distractor})}this.addLogEntry({type:"init",time:new Date,bindings:a})},window.ParsonsWidget=m}($,_);